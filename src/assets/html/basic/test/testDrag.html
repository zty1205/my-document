<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        body{
            margin:0;
            position: relative;
        }
        .box {
            width: 120px;
            height: 80px;
            text-align: center;
            margin: 10px 10px;
            position: absolute;
            background: red;
        }
    </style>
</head>
<body>
    <!-- <div id="drag-box" class="box" draggable="true">
        可拖动
    </div> -->
    <div id="drag-box2" class="box" draggable="true">
        可拖动
    </div>
<script>
    // div 自身的偏移量 + 鼠标的移动量
    var p3 = document.querySelector(".box2")
    p3.ondragstart=function(e){
        //记录刚一拖动时，鼠标在飞机上的偏移量
        offsetX= e.offsetX;
        offsetY= e.offsetY;
        console.log("start pageX = ", e.pageX)
        console.log("start pageY = ", e.pageY)
        // console.log("start offsetX = ", offsetX)
        // console.log("start offsetY = ", offsetY)
    }
    p3.ondrag=function(e){
        var x= e.pageX;
        var y= e.pageY;

        console.log("on drop pageX = ", e.pageX)
        console.log("on drop pageY = ", e.pageY)
        //drag事件最后一刻，无法读取鼠标的坐标，pageX和pageY都变为0
        if(x==0 && y==0){
            return; //不处理拖动最后一刻X和Y都为0的情形
        }
        x-=offsetX;
        y-=offsetY;
 
        p3.style.left=x+'px';
        p3.style.top=y+'px';
        // p3.style.visibility = hidden
        p3.style.opacity = 0.1
    }
    p3.ondragend=function(e){
        var x= e.pageX;
        var y= e.pageY;
        console.log('源对象p3拖动结束');
        console.log("end pageX = ", e.pageX)
        console.log("end pageY = ", e.pageY)
        console.log("end offsetX = ", e.offsetX)
        console.log("end offsetY = ", e.offsetY)

        x-=offsetX;
        y-=offsetY;
 
        p3.style.left=x+'px';
        p3.style.top=y+'px';
        // p3.style.visibility = visible
        p3.style.opacity = 1
        // left = e.pagex -startOffsetX
    }

    // var startPagex = 0
    // var startPageY = 0 

    // p3.ondragstart=function(e){

    //     startPageY = e.pageY
    //     startPagex = e.pageX
    //     console.log("startPageY = ", startPageY)
    //     console.log("startPagex = ", startPagex)
    // }
    // p3.ondrag=function(e){
        
    // }
    // p3.ondragend=function(e){
    //     console.log("offsetX = ", e.offsetX)
    //     console.log("offsetY = ", e.offsetY)
    //     var x = -startPagex + e.offsetX
    //     var y = -startPageY + e.offsetY
    //     p3.style.left=x+'px';
    //     p3.style.top=y+'px';
    // }
</script>
</body>
</html>
